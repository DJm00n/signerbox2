(this.webpackJsonpsignerbox2=this.webpackJsonpsignerbox2||[]).push([[0],{117:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(62),c=t.n(o),i=(t(70),t(3)),l=t(7),u=t(8),s=t(10),f=t(9),h=t(14),m=(t(71),t(5)),d=t(27),p=function(e){Object(s.a)(t,e);var n=Object(f.a)(t);function t(e){var a;return Object(l.a)(this,t),(a=n.call(this,e)).handleFile=a.handleFile.bind(Object(m.a)(a)),a}return Object(u.a)(t,[{key:"handleFile",value:function(e){var n=Object(h.a)(e.target.files,1)[0];return n?Object(d.a)(n).then(this.props.onAdd):null}},{key:"render",value:function(){return r.a.createElement("form",null,"Select file to sign:",r.a.createElement("input",{type:"file",name:"fileselect",value:"",onChange:this.handleFile}))}}]),t}(a.Component),v=t(29),b=t(4),y=t.n(b),g=t(22);function j(e){var n=e[e.length-1];return Boolean(128&n)}function k(e){var n=e[e.length-1];return Boolean(4&n)}function O(e){return e&&("IIT"===e.format||"jks-key"===e.format)}function w(e){return e&&"Priv"===e.type}function E(e){return e&&"x509"===e.format&&j(e.extension.keyUsage)}function S(e){return e.filter(E)[0]||null}function P(e){return e.reduce((function(e,n){return n?n.material?[].concat(Object(i.a)(e),Object(i.a)(function(e){return e.reduce((function(e,n){if(!n)return e;if(n.key&&n.certs){var t=n.certs.map((function(e){return y.a.guess_parse(e)}));e=[].concat(Object(i.a)(e),Object(i.a)(t),[{format:"jks-key",contents:n.key,name:n.name,match:S(t)}])}return e}),[])}(n.material))):"IIT"===n.format||"x509"===n.format?[].concat(Object(i.a)(e),[n]):"privkeys"===n.format?[].concat(Object(i.a)(e),Object(i.a)(n.keys)):e:e}),[])}var x=function(e){return Promise.all(Array.prototype.map.call(e,(function(e){return Object(d.a)(e).then((function(e){return function(e){return e.name.endsWith(".jks")}(e)?Object(v.a)({},e,{},Object(g.parse)(e.contents)):y.a.guess_parse(e.contents)})).catch((function(e){return console.error(e)}))}))).then(P)},C=t(13),I=t.n(C);var A=function(e,n){return"jks-key"===e.format?Object(g.decode)(e.contents,n):"IIT"===e.format||"PBES2"===e.format?I.a.compat.algos().storeload(e,n):null},F=t(18),_=t.n(F),B=t(28);function T(e){var n=_.a.TimeStampResp.decode(e,"der");if("granted"===n.status.status)return n=_.a.TSTInfo.decode(n.timeStampToken.content.contentInfo.content),console.log("resp body",n),e.slice(9);console.log("oops")}var N=function(e,n){var t=_.a.TimeStampReq.encode({version:1,messageImprint:{hashAlgorithm:{algorithm:"Gost34311"},hashedMessage:n}},"der");return Object(B.a)("https://cors-anywhere.herokuapp.com/"+e.extension.tsp,t).then(T)},U=I.a.compat.algos();function K(e,n,t){var a=U.hash(t);return N(n,a).catch((function(){return null})).then((function(r){return function(e,n,t,a,r){return new y.a.models.Message({type:"signedData",cert:n.contents?y.a.models.Certificate.from_asn1(n.contents):n,data:t,dataHash:a,tspB:r,signer:e,hash:U.hash}).as_asn1()}(e,n,t,a,r)}))}var W=function(e){Object(s.a)(t,e);var n=Object(f.a)(t);function t(e){var a;return Object(l.a)(this,t),(a=n.call(this,e)).state={password:"",error:null,keyIdx:0},a.handleFile=a.handleFile.bind(Object(m.a)(a)),a.handlePassword=a.handlePassword.bind(Object(m.a)(a)),a.handleOpen=a.handleOpen.bind(Object(m.a)(a)),a.handleSelectKey=a.handleSelectKey.bind(Object(m.a)(a)),a.handleSign=a.handleSign.bind(Object(m.a)(a)),a}return Object(u.a)(t,[{key:"handleFile",value:function(e){var n=this;x(e.target.files).then((function(e){n.props.onAdd(e)}))}},{key:"handleOpen",value:function(e){var n=this;e.preventDefault();var t=this.state,a=t.password,r=t.keyIdx,o=this.props.material,c=(o||[]).filter(O)[r||0],l=A(c,a);l?(this.setState({error:null,password:""}),x([Object(v.a)({name:"dat"},c,{contents:l})]).then((function(e){n.props.onAdd([].concat(Object(i.a)(o),Object(i.a)(e)))}))):this.setState({error:"EPASSWORD"})}},{key:"handleSelectKey",value:function(e){this.setState({keyIdx:Number(e.target.value)})}},{key:"handlePassword",value:function(e){this.setState({password:e.target.value})}},{key:"handleSign",value:function(e){e.preventDefault();var n=(this.props.material||[]).filter((function(e){return w(e)&&E(e.match)})),t=Object(h.a)(n,1)[0];this.props.onSign(K.bind(null,t,t.match))}},{key:"render",value:function(){var e=this.state,n=e.password,t=e.error,a=this.props.material,o=(a||[]).filter(O),c=(a||[]).filter((function(e){return w(e)&&E(e.match)})),i=Object(h.a)(c,1)[0];return c.length>1?r.a.createElement("div",null,"Signing keys found: ",c.length):1===c.length?r.a.createElement("div",null,r.a.createElement("button",{onClick:this.handleSign},"Sign as ",i.match.subject.title," ",i.match.subject.commonName)):r.a.createElement("div",null,!o.length&&r.a.createElement("div",null,"Select private key:",r.a.createElement("input",{type:"file",multiple:!0,name:"keyselect",value:"",onChange:this.handleFile})),o.length>0&&r.a.createElement("form",{onSubmit:this.handleOpen},o.length>1&&r.a.createElement("select",{onChange:this.handleSelectKey},o.map((function(e,n){return r.a.createElement("option",{value:n,key:n},e.match&&e.match.subject?(e.match.subject.title||"")+" "+(e.match.subject.commonName||""):e.name||n)}))),"Password:",r.a.createElement("input",{type:"password",name:"password",value:n,onChange:this.handlePassword,autoFocus:!0}),t),r.a.createElement("div",null,"Found keys: ",o.length))}}]),t}(a.Component);function M(e,n){!function(e,n){var t=document.createElement("a");t.href=e,t.download=n,document.body.appendChild(t),t.click(),document.body.removeChild(t)}("data:application/octet-stream;base64,"+Object(b.b64_encode)(e),n)}var R=function(e){Object(s.a)(t,e);var n=Object(f.a)(t);function t(e){var a;return Object(l.a)(this,t),(a=n.call(this,e)).handleSave=a.handleSave.bind(Object(m.a)(a)),a}return Object(u.a)(t,[{key:"handleSave",value:function(e){e.preventDefault();var n=this.props.file;M(n._raw||n.to_asn1(),n.name||(n.type||n.format)+".dat")}},{key:"render",value:function(){var e=this.props,n=e.file,t=e.children;return n.to_asn1||n._raw?r.a.createElement("span",null,t," (",r.a.createElement("a",{role:"link",onClick:this.handleSave},"save file"),")"):t}}]),t}(a.Component),D=function(e){Object(s.a)(t,e);var n=Object(f.a)(t);function t(){return Object(l.a)(this,t),n.apply(this,arguments)}return Object(u.a)(t,[{key:"render",value:function(){var e=this.props,n=e.type,a=e.format,o=e.subject,c=e.extension,i=e.name,l=e.match;return o?r.a.createElement("span",null,a," ",o.title," ",o.commonName," ",j(c.keyUsage)&&"SIGN"," ",function(e){var n=e[e.length-1];return Boolean(8&n)}(c.keyUsage)&&"ENC"," ",k(c.keyUsage)&&"CA"):"jks-key"===a&&l?r.a.createElement("span",null,"Encrypted Key ",i," for ",r.a.createElement(t,l)):"IIT"===a||"jks-key"===a?r.a.createElement("span",null,"Encrypted Key ",i):a?r.a.createElement("span",null,a," ?"):"Priv"===n&&l?r.a.createElement("span",null,"Private key for ",r.a.createElement(t,l)):"Priv"===n?r.a.createElement("span",null,"Private key without match"):null}}]),t}(a.Component),L=function(e){Object(s.a)(t,e);var n=Object(f.a)(t);function t(){return Object(l.a)(this,t),n.apply(this,arguments)}return Object(u.a)(t,[{key:"render",value:function(){var e=this.props.value;return e?r.a.createElement("div",null,"Key Material and Certificates",r.a.createElement("ul",null,e.map((function(e,n){return r.a.createElement("li",{key:n},r.a.createElement(R,{file:e},r.a.createElement(D,e)))})))):null}}]),t}(a.Component);function q(e){return e.map((function(n){var t,a;return n.match=(a=e,"jks-key"===(t=n).format&&t.match?t.match:"Priv"!==t.type?null:a.reduce((function(e,n){return e||("x509"!==n.format||k(n.extension.keyUsage)||!n.extension.ipn?e:(n.pubkey_unpack&&n.pubkey_unpack(),t.pub_match(n.pubkey)?n:e))}),null)),n}))}var G=t(63);var J={file:null,material:[]},H=new Proxy({title:"Signerbox2"},J),X=function(e){Object(s.a)(t,e);var n=Object(f.a)(t);function t(e){var a;return Object(l.a)(this,t),a=n.call(this,e),J.set=function(e,n,t){return e[n]=t,a.forceUpdate(),!0},a}return Object(u.a)(t,[{key:"handleAdd",value:function(e){H.material=q(e),function(e){var n=e.filter((function(e){return"Priv"===e.type&&!e.match})),t=Object(h.a)(n,2),a=t[0],r=t[1];return a?Object(G.a)([a,r]):Promise.reject()}(H.material).then((function(e){e&&(H.material=q([].concat(Object(i.a)(H.material),Object(i.a)(e))))})).catch((function(){return null}))}},{key:"handleFile",value:function(e){H.file=e}},{key:"handleSign",value:function(e){e(H.file.contents).then((function(e){return M(e,H.file.name+".p7s")}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},H.title,H.file?r.a.createElement("p",null,'Signing file "',H.file.name,'"'):r.a.createElement(p,{onAdd:this.handleFile}),H.file&&r.a.createElement(W,{material:H.material,onAdd:this.handleAdd,onSign:this.handleSign}),r.a.createElement(L,{value:H.material}))}}]),t}(a.Component),$=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function z(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(r.a.createElement(X,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/signerbox2",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/signerbox2","/service-worker.js");$?function(e){fetch(e).then((function(n){404===n.status||-1===n.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):z(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):z(e)}))}}()},27:function(e,n,t){"use strict";(function(e){function a(n){if(n.contents)return Promise.resolve(n);var t=new FileReader;return new Promise((function(a,r){t.onload=function(t){return a({name:n.name,contents:new e(t.target.result)})},t.onerror=r,t.readAsArrayBuffer(n)}))}t.d(n,"a",(function(){return a}))}).call(this,t(1).Buffer)},28:function(e,n,t){"use strict";(function(e){n.a=function(n,t,a){return fetch(n,{body:t,method:"POST",mode:"cors",headers:{"X-Requested-With":null}}).then((function(e){return e.arrayBuffer()})).then((function(n){return new e(new Uint8Array(n))}))}}).call(this,t(1).Buffer)},63:function(e,n,t){"use strict";(function(e){t.d(n,"a",(function(){return f}));var a=t(4),r=t(13),o=t.n(r),c=t(28),i=t(64),l=t.n(i);function u(e){var n;try{n=new a.models.Message(e)}catch(t){return null}return n.info?1!==n.info.readInt32LE(4)?null:(n=new a.models.Message(n.info.slice(8))).info.certificate.map((function(e){return new a.models.Certificate(e,!0)})):null}var s=["http://masterkey.ua/services/cmp/","https://ca.informjust.ua/services/cmp/"];function f(n){var t=function(n){var t=o.a.compat.algos(),r=n.map((function(e){return e&&e.pub().keyid(t)})),c=new e(120);return c.fill(0),r[0].copy(c,12),(r[1]||r[0]).copy(c,44),c[108]=1,c[112]=1,c[8]=2,c[0]=13,new a.models.Message({type:"data",data:c}).as_asn1()}(n);return l()(s.map((function(e){return function(e,n){return Object(c.a)("https://cors-anywhere.herokuapp.com/"+n,e)}(t,e).then(u).then((function(e){return e||Promise.reject()}))})))}}).call(this,t(1).Buffer)},64:function(e,n){function t(e){return new Promise((function(n,t){return e.then(t,n)}))}e.exports=function(e){return t(Promise.all(e.map(t)))}},65:function(e,n,t){e.exports=t(117)},70:function(e,n,t){},71:function(e,n,t){},78:function(e,n){}},[[65,1,2]]]);
//# sourceMappingURL=main.71fcb77c.chunk.js.map